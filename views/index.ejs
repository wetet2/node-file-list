<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Publish</title>

    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon.png">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/js/js.cookie.js"></script>

    <script type="text/javascript">
        var cookieName = 'lastPage';
        function setLastPage(){
            var lastPage =  decodeURIComponent(Cookies.get(cookieName));
            $('.file-name a').closest('td').removeClass('last-page');
            $('.file-name a').each(function(i ,e){
                if($(e).attr('href') === lastPage){
                    $(e).closest('td').addClass('last-page');
                    return false;
                }
            })
        }

        var isMobile = $(window).width() >= 767 ? true : false;

        var isSafari = /Safari/.test(navigator.userAgent) && /Apple/.test(navigator.vendor);
        if(isSafari){
            setLastPage();
            setInterval(function(){
                setLastPage();
            }, 300)
        }

        $(document).ready(function(){
            setLastPage();
            $('.refresh').click(function(){
                window.location.reload();
            })
        })

        function moveTo(path, isFile){
            if(isFile) Cookies.set(cookieName, encodeURIComponent(path));
            window.location.href = path;
        }


        function copyToClip(path, ele){
            var fullPath = window.location.origin + path;
            var t = document.createElement("input");
            t.style.opacity = 0;
            document.body.appendChild(t);
            t.value = fullPath;
            t.select();
            document.execCommand('copy');
            document.body.removeChild(t);

            $(ele).addClass('copied')

            // prompt('Press Ctrl+C',window.location.origin + path)
        }
    </script>
</head>

<body>

    <div class="publish-title">
        <label><a href="/"><b>Publish List</b></a></label>
        <span class="path"><%= path !== '' ? '( '+path+' )' : '' %></span>
        <img class="refresh" src="/images/refresh.svg" width="18px">
    </div>

    <div class="publish">
        <table class="file-table">
            <colgroup>
                <col style="width:30px;" />
                <col style="width:auto;" />
                <col style="width:80px;" />
                <col style="width:145px;" />
                <col style="width:30px;" />
            </colgroup>
            <tbody>
                <tr class="folders">
                    <td><img src="/images/folder.svg"></td>
                    <td class="folder-name prev-folder" onclick="moveTo('<%= (prevPath === '' ? '/' : prevPath)  %>')">..</td>
                    <td class="file-size"></td>
                    <td class="date"></td>
                    <td></td>
                </tr>

                <% for(var i=0; i < folderArr.length ; i++) { %>
                    <tr class="folders">
                        <td><img src="/images/folder.svg"></td>
                        <td class="folder-name" onclick="moveTo('<%= (path === '/' ? '' : path) + '/' + folderArr[i]  %>')"><%= folderArr[i] %></td>
                        <td class="file-size"></td>
                        <td class="date"></td>
                        <td class="copy" title="copy to clipboard" onclick="copyToClip('<%= (path === '/' ? '' : path) + '/' + folderArr[i] +'/'  %>', this)"></td>
                    </tr>
                <% } %>

                <% for(var i=0; i < fileArr.length ; i++) { %>
                    <tr class="files">
                        <td>
                            <img src="/images/<%= fileArr[i].icon %>.svg">
                        </td>
                        <td class="file-name" onclick="moveTo('<%= (path ==='/' ? '' : path) + "/" + fileArr[i].fileName %>', true)">
                            <a href="<%= (path ==='/' ? '' : path) + '/' + fileArr[i].fileName %>">
                                <%= fileArr[i].fileName %>
                                <img src="/images/new.svg" width="12px" class="<%= fileArr[i].isRecentCreated ? '' : 'hide' %>">
                                <img src="/images/updated.svg" width="12px" class="<%= fileArr[i].isRecentUpdated ? '' : 'hide' %>">
                            </a>
                        </td>
                        <td class="file-size"><%= fileArr[i].size %></td>
                        <td class="date"><%= fileArr[i].mDate %></td>
                        <td class="copy" title="copy to clipboard" onclick="copyToClip('<%= (path ==='/' ? '' : path) + "/" + fileArr[i].fileName %>', this)"></td>
                    </tr>
                <% } %>

            </tbody>

        </table>
    </div>

</body>

</html>
